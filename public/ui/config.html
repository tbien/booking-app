<!-- public/ui/config.html -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rezerwacje (iCal)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      background: #0b1020;
      color: #e4e8ff;
    }
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }
    .toolbar {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }
    .card {
      background: #111633;
      border: 1px solid #1f2752;
      border-radius: 10px;
      padding: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th,
    td {
      padding: 10px 12px;
      border-bottom: 1px solid #1f2752;
      font-size: 14px;
    }
    th {
      text-align: left;
      color: #aab5ff;
      font-weight: 600;
    }
    tr:hover {
      background: #0f1430;
    }
    .badge {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-pilne {
      background: #2a1831;
      color: #ff7ad9;
      border: 1px solid #4a2457;
    }
    .badge-normalne {
      background: #142b37;
      color: #6fe7ff;
      border: 1px solid #2a5f74;
    }
    .muted {
      color: #8ea2ff;
    }
    .footer {
      margin-top: 12px;
      color: #7b86b6;
      font-size: 13px;
    }
    select,
    button {
      background: #0d1330;
      border: 1px solid #273066;
      color: #e4e8ff;
      padding: 8px 10px;
      border-radius: 8px;
    }
    a {
      color: #88c6ff;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .input {
      width: 100%;
      background: #0d1330;
      border: 1px solid #273066;
      color: #e4e8ff;
      padding: 6px 8px;
      border-radius: 8px;
    }
    .list {
      margin: 8px 0;
      padding-left: 18px;
      color: #aab5ff;
    }
    .chip {
      display: inline-block;
      background: #0d1330;
      border: 1px solid #273066;
      border-radius: 999px;
      padding: 4px 8px;
      margin: 2px 4px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="margin-bottom: 18px">
      <a href="/index.html">
        <button type="button" style="margin-bottom: 8px">
          ‚Üê Powr√≥t do g≈Ç√≥wnej strony
        </button>
      </a>
    </div>
    <h2>Property iCal Config</h2>
    <form id="addForm" style="margin-bottom: 16px">
      <input name="name" class="input" placeholder="Property Name" required />
      <input name="icalUrl" class="input" placeholder="iCal URL" required />
      <button>Add</button>
    </form>

    <div class="card">
      <table id="propTable">
        <thead>
          <tr>
            <th>Nazwa</th>
            <th>iCal URL</th>
            <th style="width: 120px">Akcje</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows generated by JS -->
        </tbody>
      </table>
    </div>
  </div>
  <script>
    let editingId = null

    async function load() {
      const res = await fetch('/ical/properties')
      const data = await res.json()
      const tbody = document.querySelector('#propTable tbody')
      tbody.innerHTML = data.properties
        .map((p) => {
          if (editingId === p._id) {
            return `<tr>
            <td><input class="input" id="editName" value="${p.name}"></td>
            <td><input class="input" id="editUrl" value="${p.icalUrl}"></td>
            <td>
              <button onclick="saveEdit('${p._id}')">üíæ</button>
              <button onclick="cancelEdit()">‚úñÔ∏è</button>
            </td>
          </tr>`
          }
          return `<tr>
          <td>${p.name}</td>
          <td class="muted" style="font-size:12px;word-break:break-all">${p.icalUrl}</td>
          <td>
            <button onclick="startEdit('${p._id}')">‚úèÔ∏è</button>
            <button onclick="del('${p._id}')" style="color:#ff7ad9">üóëÔ∏è</button>
          </td>
        </tr>`
        })
        .join('')
    }

    document.getElementById('addForm').onsubmit = async (e) => {
      e.preventDefault()
      const form = e.target
      await fetch('/ical/properties', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: form.name.value,
          icalUrl: form.icalUrl.value,
        }),
      })
      form.reset()
      load()
    }

    window.del = async function (id) {
      if (!confirm('Na pewno usunƒÖƒá?')) return
      await fetch('/ical/properties/' + id, { method: 'DELETE' })
      load()
    }

    window.startEdit = function (id) {
      editingId = id
      load()
    }

    window.cancelEdit = function () {
      editingId = null
      load()
    }

    window.saveEdit = async function (id) {
      const name = document.getElementById('editName').value
      const icalUrl = document.getElementById('editUrl').value
      await fetch('/ical/properties/' + id, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, icalUrl }),
      })
      editingId = null
      load()
    }

    load()
  </script>
</body>
